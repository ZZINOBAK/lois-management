<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Lois – Cake Reservations</title>
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">

    <script>
        function showPreparing(){ alert("준비 중입니다."); }

    </script>



    <script src="https://unpkg.com/htmx.org@1.9.11"></script>
</head>

<body>
<main class="wrap">
    <header>
        <a th:href="@{/}">
            <img th:src="@{/images/logo_lois.png}" src="/images/logo_lois.png" alt="Lois by Auntie Jin" class="logo">
        </a>
        <div class="header-center">Management</div>

        <nav class="nav">
            <button type="button" onclick="showPreparing()">직원 관리</button>
            <button type="button" onclick="showPreparing()">상품 관리</button>
            <button type="button" onclick="showPreparing()">케이크 관리</button>
        </nav>
    </header>


    <section class="content">
        <div class="list-header">
            <div>
                <h2 class="section-title">케이크 예약 리스트</h2>
                <div class="filters">
                    <!-- 전체: scope=all -->
                    <button class="chip"
                            type="button"
                            hx-get="/reservations/sort?scope=all"
                            hx-target="#list"
                            hx-swap="innerHTML">
                        전체
                    </button>
                    <button class="chip" type="button" onclick="showPreparing()">날짜</button>
                    <!-- 오늘: scope=today -->
                    <button class="chip"
                            type="button"
                            hx-get="/reservations/sort?scope=today"
                            hx-target="#list"
                            hx-swap="innerHTML">
                        오늘
                    </button>
                </div>
            </div>

            <!-- 오른쪽 영역 묶기 -->
            <div class="actions-right">
                <!-- 예약하기 버튼 -->
                <a class="cta" th:href="@{/reservations/new}" role="button">
                    <div class="title">예약하기</div>
                </a>

                <!-- 샘플 버튼 (작게) -->
                <form th:action="@{/reservations/sample}" method="post">
                    <button class="cta-sample" type="submit">샘플</button>
                </form>
            </div>
        </div>

        <div class="thead">
            <div>날짜</div>
            <div>시간</div>
            <div>맛</div>
            <div>호수</div>
            <div>연락처</div>
            <div>결제</div>
            <div style="text-align:right">수정/삭제</div>
        </div>

        <div id="list" th:fragment="list">
<!--        <div id="list">-->
            <div th:each="r : ${reservations}" class="row">
                <div th:text="${#temporals.format(r.resDate, 'yyyy-MM-dd')}"></div>
                <div th:text="${#temporals.format(r.resTime, 'HH:mm')}"></div>
                <div class="ellipsis" th:text="${r.cakeFlavor}"></div>
                <div th:text="${r.cakeSize}"></div>
                <div class="ellipsis" th:text="${r.contact}"></div>
                <div th:text="${r.paid}"></div>
                <div class="actions">
                    <button class="btn"
                            type="button"
                            th:onclick="|location.href='@{/reservations/{id}/edit(id=${r.id})}'|">
                        수정
                    </button>
                    <button
                            class="btn"
                            type="button"
                            th:onclick="|openConfirmModal('@{/reservations/{id}(id=${r.id})}')|">
                        삭제
                    </button>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">© Lois by Auntie Jin</footer>

    <!-- 삭제 확인 모달 -->
    <div id="confirm-modal" class="confirm-modal hidden">

        <div class="confirm-modal__content">
            <p class="confirm-modal__text">정말 이 예약을 삭제하시겠어요?</p>

            <div class="confirm-modal__actions">
                <button id="confirm-yes"
                        class="confirm-modal__btn confirm-modal__btn--yes">
                    예
                </button>
                <button id="confirm-no"
                        class="confirm-modal__btn confirm-modal__btn--no">
                    아니오
                </button>
            </div>
        </div>
    </div>
</main>


<script>
    let pendingDeleteUrl = null;

    function openConfirmModal(url) {

        pendingDeleteUrl = url;
        document.getElementById("confirm-modal").classList.remove("hidden");
    }

    function closeConfirmModal() {
        pendingDeleteUrl = null;
        document.getElementById("confirm-modal").classList.add("hidden");
    }

    document.getElementById("confirm-yes").addEventListener("click", function() {
        if (pendingDeleteUrl) {
            htmx.ajax('DELETE', pendingDeleteUrl, {
                target: '#list',
                swap: 'innerHTML'
            });
        }
        closeConfirmModal();
    });

    document.getElementById("confirm-no").addEventListener("click", closeConfirmModal);
</script>
</body>
</html>
